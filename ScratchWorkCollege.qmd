---
title: "College Scratch"
author: "Corbin B; Matthew W"
format: pdf
editor: visual
---

```{r}

library(tidyverse)

```

```{r}

sal_df <- vroom::vroom("Salary.csv")

sal_df <- sal_df |>
  mutate(
    MajorCategory = factor(MajorCategory),
    Sex = factor(Sex)
  )

sal_lm<-lm(Salary~ .,sal_df)
sal_lm_int_GPA_MAJ  <- lm(Salary ~ GPA * MajorCategory + Sex, data = sal_df)

head(sal_df)
```

## Impact of GPA - Corbin

### What impact, if any, does GPA have on salary? Do you think students should be hyper-anxious about grades?

```{r}


# 1) Pull GPA beta (estimate) and p-value from the summary object
smry <- summary(sal_lm)
coef_mat <- smry$coefficients

gpa_estimate <- coef_mat["GPA", "Estimate"]
gpa_pvalue   <- coef_mat["GPA", "Pr(>|t|)"]

# 2) Confidence interval (default 95%)
gpa_ci <- confint(sal_lm, "GPA", level = 0.95)

# Print nicely
cat("GPA beta (Estimate):", round(gpa_estimate, 4), "\n")
cat("GPA p-value        :", signif(gpa_pvalue, 4), "\n")
cat("GPA 95% CI         : [",
    round(gpa_ci[1], 4), ", ", round(gpa_ci[2], 4), "]\n", sep = "")


```

### Is the effect of GPA different for different majors (does GPA matter more for some majors than others)?.

```{r}

# -------------------------
# Helper: per-major GPA effects (beta, p, 95% CI), no SE/stat printed
# -------------------------
per_major_gpa_effects <- function(model, major_var = "MajorCategory", gpa_var = "GPA", level = 0.95) {
  sm   <- summary(model)
  cf   <- sm$coefficients
  V    <- vcov(model)
  levs <- levels(model$model[[major_var]])
  ref  <- levs[1]  # reference level

  term_gpa <- gpa_var
  out <- list()

  # Baseline (reference major)
  est_ref <- cf[term_gpa, "Estimate"]
  se_ref  <- cf[term_gpa, "Std. Error"]
  p_ref   <- cf[term_gpa, "Pr(>|t|)"]

  alpha <- 1 - level
  tcrit <- qt(1 - alpha/2, df = sm$df[2])
  ci_ref <- c(est_ref - tcrit * se_ref, est_ref + tcrit * se_ref)

  out[[ref]] <- tibble(
    MajorCategory = ref,
    estimate      = est_ref,
    p_value       = p_ref,
    conf_low      = ci_ref[1],
    conf_high     = ci_ref[2]
  )

  # Non-reference majors: slope = beta_GPA + beta_interaction
  for (k in levs[-1]) {
    ti1 <- paste0(gpa_var, ":", major_var, k)
    ti2 <- paste0(major_var, k, ":", gpa_var)
    ti  <- c(ti1, ti2)[c(ti1, ti2) %in% rownames(cf)][1]
    if (is.na(ti)) next

    est <- cf[term_gpa, "Estimate"] + cf[ti, "Estimate"]
    var_ <- V[term_gpa, term_gpa] + V[ti, ti] + 2 * V[term_gpa, ti]
    se   <- sqrt(var_)
    tval <- est / se
    pval <- 2 * pt(abs(tval), df = sm$df[2], lower.tail = FALSE)
    ci   <- c(est - tcrit * se, est + tcrit * se)

    out[[k]] <- tibble(
      MajorCategory = k,
      estimate      = est,
      p_value       = pval,
      conf_low      = ci[1],
      conf_high     = ci[2]
    )
  }

  bind_rows(out) |>
    arrange(MajorCategory)
}

# -------------------------
# 1) Per-major GPA slopes (beta, p, CI)
# -------------------------
gpa_by_major_tbl <- per_major_gpa_effects(
  model     = sal_lm_int_GPA_MAJ,
  major_var = "MajorCategory",
  gpa_var   = "GPA",
  level     = 0.95
)

cat("\n=== GPA slope within each MajorCategory (beta, p, 95% CI) ===\n")
gpa_by_major_tbl |>
  mutate(
    across(c(estimate, conf_low, conf_high), ~round(.x, 3)),
    p_value = signif(p_value, 3)
  ) |>
  print(n = Inf)

# -------------------------
# 2) Raw interaction terms (difference vs. reference major) + 95% CI
# -------------------------
sm_int <- summary(sal_lm_int_GPA_MAJ)
cf_mat <- sm_int$coefficients
ci_all <- confint(sal_lm_int_GPA_MAJ, level = 0.95)

interaction_rows <- rownames(cf_mat)[
  grepl("^GPA:MajorCategory|^MajorCategory.+:GPA$", rownames(cf_mat))
]

interaction_tbl <- tibble(
  term      = interaction_rows,
  estimate  = cf_mat[interaction_rows, "Estimate"],
  p_value   = cf_mat[interaction_rows, "Pr(>|t|)"],
  conf_low  = ci_all[interaction_rows, 1],
  conf_high = ci_all[interaction_rows, 2]
) |>
  arrange(term)

cat("\n=== Interaction terms: difference in GPA slope vs. reference major ===\n")
interaction_tbl |>
  mutate(
    across(c(estimate, conf_low, conf_high), ~round(.x, 3)),
    p_value = signif(p_value, 3)
  ) |>
  print(n = Inf)

# -------------------------
# 3) F-tests (does interaction improve fit?)
# -------------------------
cat("\n=== Nested model comparison (no interaction vs. with interaction) ===\n")
print(anova(sal_lm, sal_lm_int_GPA_MAJ))

cat("\n=== Drop1 test (joint test of GPA:MajorCategory block) ===\n")
print(drop1(sal_lm_int_GPA_MAJ, test = "F"))




```

## Salaries Across Majors - Matthew

```{r}

# linear model predicting Salary by Major Category
maj_lm <- lm(Salary ~ MajorCategory, data = sal_df)
summary(maj_lm)


```

Yes, we see that "Engineering", "Computers and Mathematics", and "Physical Sciences" make the most when ignoring all other varaibles.

## Salaries for Women and Men - Corbin

```{r}
sal_lm_sex_major <- lm(
  Salary ~ GPA + Sex * MajorCategory,
  data = sal_df
)

summary(sal_lm_sex_major)

```

## Other Factors - Matthew

```{r}

# linear model using all predictors and no interactions
sal_lm<-lm(Salary~ .,sal_df)

# linear model using all predictors and interactions found to be significant:
sal_interaction_lm <- lm(Salary ~ MajorCategory * Sex + MajorCategory * GPA, data = sal_df)


anova(sal_lm, sal_interaction_lm)
summary(sal_interaction_lm)



```
